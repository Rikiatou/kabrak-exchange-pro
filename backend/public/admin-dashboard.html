<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KABRAK Admin Dashboard</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõ°Ô∏è</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
        :root { --green: #0B6E4F; --gold: #e8a020; --dark: #071a12; --darker: #050f0b; --gray-900: #111827; --gray-800: #1f2937; --gray-700: #374151; --gray-600: #4b5563; --gray-500: #6b7280; --gray-400: #9ca3af; --gray-200: #e5e7eb; }
        html, body { height: 100%; }
        body { background: var(--dark); font-family: Inter, system-ui, -apple-system, sans-serif; color: var(--gray-200); font-size: 14px; line-height: 1.5; }

        /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
        #loginScreen { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 16px; }
        .login-card { background: var(--gray-800); border: 1px solid var(--gray-700); border-radius: 16px; padding: 32px; width: 100%; max-width: 380px; box-shadow: 0 25px 50px rgba(0,0,0,0.5); }
        .login-logo { width: 64px; height: 64px; background: #064e3b; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 12px; }
        .login-logo i { font-size: 24px; color: #34d399; }
        .login-title { text-align: center; color: var(--gold); font-size: 20px; font-weight: 700; }
        .login-sub { text-align: center; color: var(--gray-400); font-size: 13px; margin-top: 4px; margin-bottom: 24px; }
        .form-group { margin-bottom: 16px; }
        .form-label { display: block; font-size: 13px; color: var(--gray-400); margin-bottom: 6px; }
        .form-input { width: 100%; padding: 12px; background: var(--gray-700); border: 1px solid var(--gray-600); border-radius: 8px; color: #fff; font-size: 14px; outline: none; transition: border-color .2s; }
        .form-input:focus { border-color: var(--green); }
        .btn-primary { width: 100%; padding: 12px; background: var(--green); color: #fff; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: opacity .2s; }
        .btn-primary:hover { opacity: .9; }
        .btn-primary:disabled { opacity: .6; cursor: not-allowed; }
        .login-error { color: #f87171; font-size: 13px; text-align: center; margin-top: 10px; display: none; }

        /* ‚îÄ‚îÄ Dashboard layout ‚îÄ‚îÄ */
        #dashboardScreen { display: flex; min-height: 100vh; }
        .sidebar { width: 240px; min-height: 100vh; background: var(--darker); display: flex; flex-direction: column; position: fixed; top: 0; left: 0; z-index: 40; transition: width .2s; border-right: 1px solid #0d1f16; }
        .sidebar.collapsed { width: 64px; }
        .sidebar.collapsed .nav-label, .sidebar.collapsed .logo-text, .sidebar.collapsed .user-info { display: none; }
        .main-content { margin-left: 240px; flex: 1; min-height: 100vh; transition: margin-left .2s; }
        .main-content.expanded { margin-left: 64px; }

        /* ‚îÄ‚îÄ Sidebar ‚îÄ‚îÄ */
        .sidebar-header { padding: 16px; display: flex; align-items: center; gap: 10px; border-bottom: 1px solid #0d1f16; }
        .sidebar-logo-icon { width: 32px; height: 32px; background: var(--green); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .sidebar-logo-icon i { color: #fff; font-size: 13px; }
        .logo-text { color: var(--gold); font-weight: 700; font-size: 13px; white-space: nowrap; }
        .sidebar-nav { flex: 1; padding: 12px 8px; display: flex; flex-direction: column; gap: 4px; }
        .nav-item { display: flex; align-items: center; gap: 10px; padding: 10px 12px; border-radius: 8px; cursor: pointer; color: var(--gray-400); font-size: 13px; text-decoration: none; transition: background .15s, color .15s; white-space: nowrap; border: none; background: none; width: 100%; text-align: left; }
        .nav-item:hover { background: var(--gray-800); color: var(--gray-200); }
        .nav-item.active { background: var(--green); color: #fff; }
        .nav-item.active i, .nav-item.active span { color: #fff; }
        .nav-item i { width: 18px; text-align: center; flex-shrink: 0; }
        .sidebar-footer { padding: 16px; border-top: 1px solid #0d1f16; }
        .user-row { display: flex; align-items: center; gap: 10px; }
        .user-avatar { width: 32px; height: 32px; background: #064e3b; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .user-avatar i { color: #34d399; font-size: 12px; }
        .user-info { display: flex; flex-direction: column; }
        .user-name { font-size: 12px; font-weight: 600; color: var(--gray-200); }
        .btn-logout { font-size: 11px; color: #f87171; background: none; border: none; cursor: pointer; padding: 0; text-align: left; }
        .btn-logout:hover { color: #fca5a5; }
        .pending-badge { margin-left: auto; background: #d97706; color: #fff; font-size: 11px; padding: 1px 7px; border-radius: 999px; display: none; }

        /* ‚îÄ‚îÄ Top bar ‚îÄ‚îÄ */
        .topbar { position: sticky; top: 0; z-index: 30; background: rgba(7,26,18,0.95); backdrop-filter: blur(8px); border-bottom: 1px solid #0d1f16; padding: 12px 24px; display: flex; align-items: center; justify-content: space-between; }
        .topbar-left { display: flex; align-items: center; gap: 12px; }
        #pageTitle { color: #fff; font-size: 17px; font-weight: 700; }
        .topbar-right { display: flex; align-items: center; gap: 8px; }
        .btn-icon { background: none; border: none; color: var(--gray-400); cursor: pointer; padding: 7px; border-radius: 8px; font-size: 14px; transition: background .15s, color .15s; }
        .btn-icon:hover { background: var(--gray-800); color: #fff; }
        #lastRefresh { font-size: 11px; color: var(--gray-500); }

        /* ‚îÄ‚îÄ Content ‚îÄ‚îÄ */
        .page-content { padding: 24px; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* ‚îÄ‚îÄ Stat cards ‚îÄ‚îÄ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: linear-gradient(135deg, #1a2e24, #0d1f16); border: 1px solid #1a3d2e; border-radius: 14px; padding: 18px; transition: border-color .2s, transform .2s; }
        .stat-card:hover { border-color: var(--green); transform: translateY(-2px); }
        .stat-card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .stat-label { color: var(--gray-400); font-size: 12px; }
        .stat-value { color: #fff; font-size: 28px; font-weight: 800; line-height: 1; }
        .stat-sub { color: var(--gray-500); font-size: 12px; margin-top: 4px; }
        .stat-value.orange { color: #fb923c; }
        .stat-value.red { color: #f87171; }

        /* ‚îÄ‚îÄ Panels ‚îÄ‚îÄ */
        .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .two-col { grid-template-columns: 1fr; } }
        .panel { background: var(--gray-800); border: 1px solid var(--gray-700); border-radius: 14px; padding: 20px; }
        .panel-title { font-size: 14px; font-weight: 600; color: #fff; margin-bottom: 16px; }
        .panel-title i { margin-right: 8px; }
        .activity-item { display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 8px; margin-bottom: 6px; }
        .activity-item:hover { background: rgba(255,255,255,0.04); }
        .activity-avatar { width: 34px; height: 34px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: 700; flex-shrink: 0; background: #064e3b; color: #34d399; }
        .activity-info { flex: 1; min-width: 0; }
        .activity-name { font-size: 13px; font-weight: 500; color: var(--gray-200); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .activity-meta { font-size: 11px; color: var(--gray-500); }
        .activity-date { font-size: 11px; color: var(--gray-500); flex-shrink: 0; }

        /* ‚îÄ‚îÄ Toolbar ‚îÄ‚îÄ */
        .toolbar { display: flex; flex-wrap: wrap; align-items: center; gap: 8px; margin-bottom: 16px; }
        .filter-btn { padding: 6px 14px; border-radius: 8px; border: none; background: var(--gray-700); color: var(--gray-400); font-size: 13px; cursor: pointer; transition: background .15s, color .15s; }
        .filter-btn:hover { background: var(--gray-600); color: #fff; }
        .filter-btn.active { background: var(--green); color: #fff; }
        .search-input { margin-left: auto; padding: 6px 12px; background: var(--gray-700); border: 1px solid var(--gray-600); border-radius: 8px; color: #fff; font-size: 13px; outline: none; width: 200px; }
        .search-input:focus { border-color: var(--green); }
        .btn-create { padding: 6px 14px; border-radius: 8px; border: none; background: var(--green); color: #fff; font-size: 13px; font-weight: 600; cursor: pointer; }
        .btn-create:hover { opacity: .9; }

        /* ‚îÄ‚îÄ Tables ‚îÄ‚îÄ */
        .table-wrap { background: var(--gray-800); border: 1px solid var(--gray-700); border-radius: 14px; overflow: hidden; }
        .table-scroll { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; color: var(--gray-200); }
        thead tr { border-bottom: 1px solid var(--gray-700); }
        th { padding: 10px 14px; text-align: left; font-size: 11px; font-weight: 600; color: var(--gray-400); text-transform: uppercase; letter-spacing: .05em; white-space: nowrap; }
        th.center, td.center { text-align: center; }
        td { padding: 12px 14px; border-top: 1px solid #1a2530; vertical-align: middle; }
        tbody tr:hover td { background: rgba(11,110,79,0.06); }

        /* ‚îÄ‚îÄ Badges ‚îÄ‚îÄ */
        .badge { display: inline-block; padding: 2px 9px; border-radius: 999px; font-size: 11px; font-weight: 600; }
        .badge-active, .badge-validated { background: rgba(16,185,129,.15); color: #34d399; }
        .badge-pending { background: rgba(245,158,11,.15); color: #fbbf24; }
        .badge-expired, .badge-rejected { background: rgba(239,68,68,.15); color: #f87171; }
        .badge-suspended { background: rgba(139,92,246,.15); color: #a78bfa; }
        .badge-gray { background: rgba(255,255,255,.08); color: var(--gray-400); }

        /* ‚îÄ‚îÄ Action buttons ‚îÄ‚îÄ */
        .action-btns { display: flex; align-items: center; justify-content: center; gap: 6px; }
        .btn-sm { padding: 4px 9px; border-radius: 6px; border: none; cursor: pointer; font-size: 12px; color: #fff; }
        .btn-green { background: #065f46; } .btn-green:hover { background: #047857; }
        .btn-blue { background: #1e40af; } .btn-blue:hover { background: #1d4ed8; }
        .btn-purple { background: #5b21b6; } .btn-purple:hover { background: #6d28d9; }
        .btn-red { background: #991b1b; } .btn-red:hover { background: #b91c1c; }

        /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.6); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 100; padding: 16px; }
        .modal-box { background: var(--gray-800); border: 1px solid var(--gray-700); border-radius: 16px; padding: 24px; width: 100%; max-width: 440px; box-shadow: 0 25px 50px rgba(0,0,0,.5); }
        .modal-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; }
        .modal-title { font-size: 16px; font-weight: 700; color: #fff; }
        .modal-footer { display: flex; gap: 10px; margin-top: 20px; }
        .btn-cancel { flex: 1; padding: 10px; background: var(--gray-700); color: var(--gray-200); border: none; border-radius: 8px; cursor: pointer; font-size: 14px; }
        .btn-confirm { flex: 1; padding: 10px; background: var(--green); color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 14px; font-weight: 600; }
        .modal-field { margin-bottom: 14px; }
        .modal-label { display: block; font-size: 12px; color: var(--gray-400); margin-bottom: 5px; }
        .modal-input { width: 100%; padding: 10px; background: var(--gray-700); border: 1px solid var(--gray-600); border-radius: 8px; color: #fff; font-size: 14px; outline: none; }
        .modal-input:focus { border-color: var(--green); }

        /* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
        #toastContainer { position: fixed; top: 16px; right: 16px; z-index: 200; display: flex; flex-direction: column; gap: 8px; }
        .toast { display: flex; align-items: center; gap: 8px; padding: 12px 16px; border-radius: 10px; font-size: 13px; font-weight: 500; box-shadow: 0 4px 12px rgba(0,0,0,.3); animation: slideIn .3s ease-out; }
        .toast-success { background: #064e3b; color: #6ee7b7; }
        .toast-error { background: #7f1d1d; color: #fca5a5; }
        @keyframes slideIn { from { transform: translateX(110%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* ‚îÄ‚îÄ Spinner ‚îÄ‚îÄ */
        .spinner { display: inline-block; width: 18px; height: 18px; border: 3px solid rgba(255,255,255,.2); border-top-color: #fff; border-radius: 50%; animation: spin .6s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* ‚îÄ‚îÄ Mobile ‚îÄ‚îÄ */
        @media (max-width: 768px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.mobile-open { transform: translateX(0); }
            .main-content { margin-left: 0 !important; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
        }
        @media (max-width: 480px) {
            .stats-grid { grid-template-columns: 1fr; }
            .page-content { padding: 12px; }
        }
    </style>
</head>
<body>

<!-- Login Screen -->
<div id="loginScreen">
    <div class="login-card">
        <div class="login-logo"><i class="fas fa-shield-halved"></i></div>
        <div class="login-title">KABRAK Admin</div>
        <div class="login-sub">Panneau d'administration</div>
        <form id="loginForm">
            <div class="form-group">
                <label class="form-label">Identifiant</label>
                <input type="text" id="loginUser" class="form-input" required>
            </div>
            <div class="form-group">
                <label class="form-label">Mot de passe</label>
                <input type="password" id="loginPass" class="form-input" required>
            </div>
            <button type="submit" id="loginBtn" class="btn-primary">Se connecter</button>
            <div id="loginError" class="login-error"></div>
        </form>
        <div style="margin-top:20px;padding:12px 16px;background:rgba(11,110,79,0.12);border:1px solid rgba(11,110,79,0.3);border-radius:10px;">
            <div style="font-size:11px;color:#6b7280;font-weight:600;text-transform:uppercase;letter-spacing:.05em;margin-bottom:8px;">Identifiants par d√©faut</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
                <span style="font-size:12px;color:#9ca3af;">Utilisateur</span>
                <span style="font-size:13px;font-weight:700;color:#e8a020;font-family:monospace;cursor:pointer" onclick="document.getElementById('loginUser').value='kabrak'">kabrak</span>
            </div>
            <div style="display:flex;justify-content:space-between;align-items:center;">
                <span style="font-size:12px;color:#9ca3af;">Mot de passe</span>
                <span style="font-size:13px;font-weight:700;color:#e8a020;font-family:monospace;cursor:pointer" onclick="document.getElementById('loginPass').value='Admin@1234'">Admin@1234</span>
            </div>
            <div style="margin-top:8px;font-size:11px;color:#6b7280;text-align:center;">Cliquer pour remplir automatiquement</div>
        </div>
    </div>
</div>

<!-- Dashboard -->
<div id="dashboardScreen" style="display:none">
    <!-- Sidebar -->
    <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo-icon"><i class="fas fa-exchange-alt"></i></div>
            <span class="logo-text">KABRAK Admin</span>
        </div>
        <nav class="sidebar-nav">
            <button onclick="switchTab('dashboard')" class="nav-item active" data-tab="dashboard">
                <i class="fas fa-chart-pie"></i><span class="nav-label">Tableau de bord</span>
            </button>
            <button onclick="switchTab('licenses')" class="nav-item" data-tab="licenses">
                <i class="fas fa-key"></i><span class="nav-label">Licences</span>
            </button>
            <button onclick="switchTab('payments')" class="nav-item" data-tab="payments">
                <i class="fas fa-credit-card"></i><span class="nav-label">Paiements</span>
                <span id="pendingBadge" class="pending-badge">0</span>
            </button>
            <button onclick="switchTab('users')" class="nav-item" data-tab="users">
                <i class="fas fa-users"></i><span class="nav-label">Utilisateurs</span>
            </button>
        </nav>
        <div class="sidebar-footer">
            <div class="user-row">
                <div class="user-avatar"><i class="fas fa-user-shield"></i></div>
                <div class="user-info">
                    <span class="user-name">Admin</span>
                    <button onclick="handleLogout()" class="btn-logout">D√©connexion</button>
                </div>
            </div>
        </div>
    </aside>

    <!-- Main -->
    <main id="mainContent" class="main-content">
        <div class="topbar">
            <div class="topbar-left">
                <button onclick="toggleSidebar()" class="btn-icon" id="menuToggle"><i class="fas fa-bars"></i></button>
                <h2 id="pageTitle">Tableau de bord</h2>
            </div>
            <div class="topbar-right">
                <button onclick="refreshData()" class="btn-icon" title="Rafra√Æchir"><i class="fas fa-sync-alt"></i></button>
                <span id="lastRefresh"></span>
            </div>
        </div>

        <div class="page-content">
            <!-- Dashboard Tab -->
            <div id="tab-dashboard" class="tab-content active">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-label">Utilisateurs</span>
                            <i class="fas fa-users" style="color:#34d399"></i>
                        </div>
                        <div class="stat-value" id="statUsers">-</div>
                        <div class="stat-sub" id="statUsersActive">- actifs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-label">Licences actives</span>
                            <i class="fas fa-key" style="color:#fbbf24"></i>
                        </div>
                        <div class="stat-value" id="statLicenses">-</div>
                        <div class="stat-sub" id="statLicensesTotal">/ - total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-label">Paiements en attente</span>
                            <i class="fas fa-clock" style="color:#fb923c"></i>
                        </div>
                        <div class="stat-value orange" id="statPending">-</div>
                        <div class="stat-sub" id="statPaymentsTotal">/ - total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <span class="stat-label">Expirent bient√¥t</span>
                            <i class="fas fa-exclamation-triangle" style="color:#f87171"></i>
                        </div>
                        <div class="stat-value red" id="statExpiring">-</div>
                        <div class="stat-sub">dans 7 jours</div>
                    </div>
                </div>

                <div class="two-col">
                    <div class="panel">
                        <div class="panel-title"><i class="fas fa-user-plus" style="color:#34d399"></i>Derniers inscrits</div>
                        <div id="recentUsersList"><div style="color:var(--gray-500);text-align:center;padding:16px;font-size:13px">Chargement...</div></div>
                    </div>
                    <div class="panel">
                        <div class="panel-title"><i class="fas fa-receipt" style="color:#fbbf24"></i>Derniers paiements</div>
                        <div id="recentPaymentsList"><div style="color:var(--gray-500);text-align:center;padding:16px;font-size:13px">Chargement...</div></div>
                    </div>
                </div>
            </div>

            <!-- Licenses Tab -->
            <div id="tab-licenses" class="tab-content">
                <div class="toolbar">
                    <button onclick="filterLicenses('')" class="filter-btn active license-filter">Toutes</button>
                    <button onclick="filterLicenses('active')" class="filter-btn license-filter">Actives</button>
                    <button onclick="filterLicenses('pending')" class="filter-btn license-filter">En attente</button>
                    <button onclick="filterLicenses('expired')" class="filter-btn license-filter">Expir√©es</button>
                    <input type="text" id="licenseSearch" placeholder="Rechercher..." oninput="renderLicenses()" class="search-input">
                    <button onclick="openCreateLicense()" class="btn-create">+ Nouvelle licence</button>
                </div>
                <div class="table-wrap">
                    <div class="table-scroll">
                        <table>
                            <thead>
                                <tr>
                                    <th>Entreprise</th><th>Email</th><th class="center">Cl√© de licence</th><th class="center">Plan</th>
                                    <th class="center">Statut</th><th class="center">Expiration</th><th class="center">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="licensesTable"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Payments Tab -->
            <div id="tab-payments" class="tab-content">
                <div class="toolbar">
                    <button onclick="filterPayments('')" class="filter-btn active payment-filter">Tous</button>
                    <button onclick="filterPayments('pending')" class="filter-btn payment-filter">En attente</button>
                    <button onclick="filterPayments('validated')" class="filter-btn payment-filter">Valid√©s</button>
                    <button onclick="filterPayments('rejected')" class="filter-btn payment-filter">Rejet√©s</button>
                </div>
                <div class="table-wrap"><div class="table-scroll">
                    <table>
                        <thead><tr>
                            <th>Utilisateur</th><th class="center">Plan</th><th class="center">Montant</th>
                            <th class="center">M√©thode</th><th class="center">R√©f√©rence</th>
                            <th class="center">Statut</th><th class="center">Date</th><th class="center">Actions</th>
                        </tr></thead>
                        <tbody id="paymentsTable"></tbody>
                    </table>
                </div></div>
            </div>

            <!-- Users Tab -->
            <div id="tab-users" class="tab-content">
                <div class="toolbar">
                    <input type="text" id="userSearch" placeholder="Rechercher par email ou nom..." oninput="renderUsers()" class="search-input" style="margin-left:0;width:280px">
                </div>
                <div class="table-wrap"><div class="table-scroll">
                    <table>
                        <thead><tr>
                            <th>Nom</th><th>Email</th><th>Entreprise</th>
                            <th class="center">R√¥le</th><th class="center">Statut</th>
                            <th class="center">Derni√®re connexion</th><th class="center">Actions</th>
                        </tr></thead>
                        <tbody id="usersTable"></tbody>
                    </table>
                </div></div>
            </div>
        </div>
    </main>
</div>

<!-- Action Modal -->
<div id="modal" style="display:none" class="modal-overlay">
    <div class="modal-box">
        <div class="modal-header">
            <span id="modalTitle" class="modal-title"></span>
            <button onclick="closeModal()" class="btn-icon"><i class="fas fa-times"></i></button>
        </div>
        <div id="modalBody"></div>
        <div class="modal-footer">
            <button onclick="closeModal()" class="btn-cancel">Annuler</button>
            <button id="modalConfirmBtn" class="btn-confirm">Confirmer</button>
        </div>
    </div>
</div>

<!-- Toast -->
<div id="toastContainer"></div>

<script src="admin-dashboard.js"></script>
</body>
</html>
